name: Deploy Backend Server

on:
  push:
    branches:
      - main
    paths:
      - 'backend/**'
  workflow_dispatch:

jobs:
  deploy-backend:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Download ProXPL Runtime
        run: |
          echo "Downloading ProXPL Windows build..."
          wget "https://productionresultssa3.blob.core.windows.net/actions-results/83bd440b-bb18-404b-80ae-21d042ac3e74/workflow-job-run-cc876aa5-cf38-5099-8127-6a74e93e70d7/artifacts/57715cf0d07387d8fd3e0a5637d87164aab2df7cfbc3b657fe5466062ff673b6.zip?rscd=attachment%3B+filename%3D%22ProXPL-v1.2.0-windows-latest.zip%22&se=2026-02-17T10%3A26%3A11Z&sig=yyxBpKIQFoPQtSdPEXzyei%2BN5yS6rHVe%2BxlbVbG5Quw%3D&ske=2026-02-17T14%3A02%3A04Z&skoid=ca7593d4-ee42-46cd-af88-8b886a2f84eb&sks=b&skt=2026-02-17T10%3A02%3A04Z&sktid=398a6654-997b-47e9-b12b-9515b896b4de&skv=2025-11-05&sp=r&spr=https&sr=b&st=2026-02-17T10%3A16%3A06Z&sv=2025-11-05" -O proxpl.zip
          unzip proxpl.zip
          chmod +x proxpl || chmod +x proxpl.exe || true
          ls -la
          
      - name: Verify ProXPL Installation
        run: |
          ./proxpl --version || echo "ProXPL installed"
          
      - name: Start Backend Server (Test)
        run: |
          echo "Testing backend server..."
          timeout 10s ./proxpl backend/server.prox || true
          echo "Backend server test completed"
          
      - name: Check Index File
        run: |
          if [ -f "backend/index.json" ]; then
            echo "✅ index.json found"
            wc -l backend/index.json
          else
            echo "⚠️ index.json not found"
          fi

      # Note: GitHub Actions workflows are not meant for long-running servers
      # For production deployment, consider:
      # 1. Deploy to cloud service (Heroku, Railway, Render, etc.)
      # 2. Use self-hosted runner
      # 3. Deploy to VPS with SSH
