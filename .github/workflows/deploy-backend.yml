name: Deploy Backend Server

on:
  push:
    branches:
      - main
    paths:
      - 'backend/**'
  workflow_dispatch:

jobs:
  deploy-backend:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Download ProXPL Runtime
        run: |
          echo "Downloading ProXPL for Linux..."
          wget https://github.com/ProgrammerKR/ProXPL/releases/latest/download/proxpl -O proxpl
          chmod +x proxpl
          
      - name: Verify ProXPL Installation
        run: |
          ./proxpl --version || echo "ProXPL installed"
          
      - name: Start Backend Server (Test)
        run: |
          echo "Testing backend server..."
          timeout 10s ./proxpl backend/server.prox || true
          echo "Backend server test completed"
          
      - name: Check Index File
        run: |
          if [ -f "backend/index.json" ]; then
            echo "✅ index.json found"
            wc -l backend/index.json
          else
            echo "⚠️ index.json not found"
          fi

      # Note: GitHub Actions workflows are not meant for long-running servers
      # For production deployment, consider:
      # 1. Deploy to cloud service (Heroku, Railway, Render, etc.)
      # 2. Use self-hosted runner
      # 3. Deploy to VPS with SSH
